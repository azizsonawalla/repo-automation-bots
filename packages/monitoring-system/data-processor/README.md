# Data Processor: GitHub Automation Bots Monitoring System

A NodeJS application to continuously consume new data generated by the automation bots as well as other related sources, process it into a standardized format, and store it in Firestore.

## Deployment

Data Processor is currently deployed to a [Cloud Run instance in the repo-automation-bots project](https://console.cloud.google.com/run/detail/us-central1/data-processor/metrics?project=repo-automation-bots). To deploy a new version, install the `gcloud` SDK, authenticate with your account, and run `npm run deploy` from the root directory.

> :warning: You will need access to this project as well as deploy privileges on the Cloud Run instance in order to deploy a new version

### Setting up permissions for Data Processor

If you want to use an existing Service Account to give Data Processor access to resources, skip to step 3.

#### Setup a service account for Data Processor

1. Create a GCP Service Account for the Cloud Run instance used by Data Processor by going to GCP Console -> IAM & Admin -> Service Accounts
2. Copy the email address associated with the Service Account you just created
3. Edit the Cloud Run instance used by Data Processor and under Container -> Service Account select the account you just created in step 2 (or an existing account you want to use with Data Processor)

#### Give Data Processor Access to Cloud Tasks

Assign the Data Processor Service Account the IAM permission `cloudtasks.tasks.list` by going to the GCP Console where the task queues live -> IAM & Admin -> IAM

#### Give Data Processor Access to Firestore

Assign the Data Processor Service Account the role `Firebase Develop Admin` in the GCP Console of the Firebase project.

## Development

### Architectural Overview

![Data Processor Class Diagram](docs/assets/class-diagram.png)

// TODO(asonawalla)

### Firestore Schema

Refer to [firestore-schema.ts](packages/monitoring-system/data-processor/src/firestore-schema.ts) for a guide on the storage schema for Data Processor.

### Add support for a new metric from an existing data source

// TODO(asonawalla)

### Add support for a new data source

// TODO(asonawalla)